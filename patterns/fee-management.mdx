---
title: "Fee management"
---

import { Aside } from '/snippets/aside.jsx';
import { FeePlayground } from '/snippets/feePlayground.jsx';

## Fee calculator

<FeePlayground />

### Example with @ton/core

```ts title="TypeScript example" expandable
// Prices
const msgPrices = getMsgPrices(configCell, 0);
const gasPrices = getGasPrices(configCell, 0);

// Forwarding for an example message (1 cell, 528 bits)
const SCALE_16 = 65536n; // 2^16
const msgFwdFees =
  msgPrices.lumpPrice +
  shr16ceil(msgPrices.bitPrice * 528n + msgPrices.cellPrice * 1n);
const actionFee = (msgFwdFees * msgPrices.firstFrac) >> 16n;
const outFwdFees = msgFwdFees - actionFee;

// Gas (example usage)
const gasUsed = 299_400n;
const gasFee =
  gasUsed <= gasPrices.flat_gas_limit
    ? gasPrices.flat_gas_price
    : gasPrices.flat_gas_price +
      (gasPrices.gas_price * (gasUsed - gasPrices.flat_gas_limit)) /
        SCALE_16;

// Storage for one day of an example state
const stateStats = new StorageStats(1323n, 3n);
const storage = getStoragePrices(configCell);
const storageFee = shr16ceil(
  (stateStats.bits * storage.bit_price_ps +
    stateStats.cells * storage.cell_price_ps) *
    86_400n
);
```

Full helper implementations: see [Fees → Helper functions appendix](/ton/fees#helper-functions).

<Aside
  type="note"
  title="Governance-controlled parameters"
>
  Avoid modifying prices with `setGasPrice`, `setMsgPrices`, or `setStoragePrices` — these are controlled by validator governance via config updates. Use read-only getters and fee calculators in app code.
</Aside>

## Accept message effects

The `accept_message` and `set_gas_limit` TVM primitives control gas limits and indicate readiness to pay fees.

### External messages

- Initial gas limit is a small credit (`gas_credit` = 10,000 gas units from config `20/21`).
- During Compute, call `accept_message` to raise the gas limit to the maximum allowed (`gm`), or use `set_gas_limit(limit)` to set it to `min(limit, gm)`.
- If `gas_credit` is exhausted or you never call `accept_message`, the external message is not included in a block and no transaction is created.
- After processing, full computation fees are deducted from the contract balance (the credit is not free gas).

If an error occurs after `accept_message`:

- A transaction is recorded and fees are paid from the contract balance.
- State changes are reverted unless you committed state explicitly.
- Actions are not applied.

<Aside type="caution" title="Funds at risk">
  Risk: accepting an invalid external message after `accept_message` charges fees and can be replayed until the balance depletes.
  Scope: the receiving contract/account.
  Mitigation: validate the message before calling `accept_message` or limit gas; consider early exits without accepting.
  Environment: applies to testnet and mainnet; rollback is not possible for spent fees.
</Aside>

### Internal messages

- Default gas limit equals `message_value / gas_price`;\
  the incoming value covers its processing.
- You may still adjust limits with `accept_message`/`set_gas_limit`.
- Bounce semantics are unaffected: a bounceable message will bounce if there is enough value to pay processing and bounce creation.
